<div class="row">
	<div class="col-md-4">
		<h2><%=@assignment.title%></h2>
		<h2><%=User.find(params[:assignment_author]).name%></h2>
		<ul>
			<%=render :partial => :step, :collection => @steps.roots%>
		</ul>
		<%if current_user.id.to_s == params[:assignment_author]%>
		<%= link_to("Add New Step", assignment_path(@assignment.id)+"/"+params[:assignment_author], class: 'btn btn-primary')%>
		<%end%>

		
		<%if current_user.admin?%>
			<h3>Path comment</h3>
			<%=form_for(@path_comment) do |f|%>
				<%=f.hidden_field :user_id, value: current_user.id%>
				<%=f.hidden_field :assignment_author, value: params[:assignment_author]%>
				<%=f.hidden_field :assignment_id, value: @assignment.id%>
				<br>
				<div class="form-group">
					<%=f.text_area :text, class:'form-control'%>
				</div>
				<%=f.hidden_field :present, value: false%>
				<%=f.submit "Save Comment", class:'btn btn-primary'%>
			<%end%>


			<%if !@presentation.new_record?%>
				<h3>Presentation comment</h3>
				<%=form_for(@presentation_comment) do |f|%>
					<%=f.hidden_field :user_id, value: current_user.id%>
					<%=f.hidden_field :assignment_author, value: params[:assignment_author]%>
					<%=f.hidden_field :assignment_id, value: @assignment.id%>
					<br>
					<div class="form-group">
						<%=f.text_area :text, class:'form-control'%>
					</div>
					<%=f.hidden_field :present, value: true%>
					<%=f.submit "Save Comment", class:'btn btn-primary'%>
				<%end%>
			<%end%>




			<%if @presentation.new_record?%>
				<%=form_for(@presentation) do |f|%>
				<%=f.hidden_field :assignment_author, value: params[:assignment_author]%>
				<%=f.hidden_field :assignment_id, value: @assignment.id%>
				<%=f.submit "Mark to Present", class:'btn btn-primary'%>
				<%end%>
			<%else%>
				<%= link_to 'Unmark to Present', @presentation, method: :delete, class:'btn btn-primary'%>
			<%end%>

		<%else%>
			<%if !@path_comment.new_record?%>
				<h3>Professor's comments:</h3>
				<p><%= @path_comment.text%></p>
			<%end%>

		<%end%>

	</div>
	<div class='col-md-8'>
		<%=form_for(@step) do |f|%>
		<%=f.hidden_field :user_id, value: params[:assignment_author]%>
		<%=f.hidden_field :assignment_id, value: @assignment.id%>
		<%if @step.new_record?%>
		<h3>Create New Step</h3>
		<%end%>
		<div class='form-group'>
			<label class='control-label col-md-2'>Title</label>
			<div class='col-md-10'>
				<%=f.text_field :title, :class=>'form-control edit'%>
				<input type='text' value='<%=@step.title%>' class='form-control view' readonly>
			</div>
		</div>
		<div class='col-md-6'>
			<div class='form-group'>
				<label class='control-label col-md-2'>URL</label>
				<div class='col-md-10'>
					<%=f.text_field :url, :class=>'form-control edit'%>
					<input type='text' value='<%=@step.url%>' class='form-control view' readonly>
				</div>
			</div>
			<div class='form-group'>
				<label class='control-label col-md-6'>Page I came from</label>
				<div class='col-md-6'>
					<%=f.select :parent_id, nested_set_options(@steps, @step) {|i| "#{'-' * i.level} #{i.title}" }.unshift(["",nil]), {},{class:'form-control edit'} %>
				<select class='form-control view' disabled>
					<%if Step.exists?(:id => @step.parent_id)%>
						<option><%=Step.find(@step.parent_id).title%></option>
					<%else%>
						<option></option>
					<%end%>
				</select>
				</div>
			</div>
			<div class='form-group'>
				<label class='control-label col-md-12'>Screenshot</label>
				<div class='col-md-12'>
					<% if @step.screenshot?%>
					<%= image_tag(@step.screenshot_url, :class=>'thumbnail', :style=>'width:100%')%>
					<%end%>
					<span class='edit'><%=f.file_field :screenshot, :class=>'form-control'%></span>
				</div>
			</div>
		</div>
		<div class='col-md-6'>
			<div class='form-group checkbox edit'>
				<label>
					<%= f.check_box :document %> This is the document I was looking for
				</label>
			</div>
			<div class='form-group checkbox view'>
				<label>
					<input type='checkbox' disabled <%="checked" if @step.document%>>This is the document I was looking for
				</label>
			</div>
			<div class='form-group checkbox edit'>
				<label>
					<%= f.check_box :favorite %> Add to favorites
				</label>
			</div>
			<div class='form-group checkbox view'>
				<label>
					<input type='checkbox' disabled <%="checked" if @step.favorite%>>Add to favorites
				</label>
			</div>
			<div class='form-group'>
				<div class='form-group'>
					<label class='col-md-12'>Justification</label>
					<div class='col-md-12'>
						<%= f.text_area :justification, :rows=>10, :class=>'form-control edit' %>
						<textarea class='form-control view' rows=10 readonly><%=@step.justification%></textarea>
					</div>
				</div>
			</div>
			<%if current_user.id.to_s == params[:assignment_author]%>
			<%=f.submit "Save", :class=>'edit btn btn-primary'%>
			<a class='edit' href='#' id='cancel'>Cancel</a>
			<button class='view btn btn-primary' id='edit'>Edit Step</button>
			<%end%>
		</div>
		<%end%>
	</div>
</div>
		<script type="text/javascript">
		function editStep(){
			$(".view").hide();
			$(".edit").show();
		}
		function viewStep(){
			$(".edit").hide();
			$(".view").show();
		}
		$(function(){
			$(".successful").parents("li").addClass("successful").removeClass("unsuccessful");
			$("#toggleSuccess").click(function(){
				if($(this).html()=="Show Successful Path"){
					$(this).html("Show All Steps");
					$(".unsuccessful").hide();
				}
				else{
					$(this).html("Show Successful Path");
					$(".unsuccessful").show();
				}
			})
			$("#cancel").click(viewStep);
			$("#edit").click(function(event){
				event.preventDefault();
				editStep();
			});	
		});
		</script>
		<style type='text/css'>
		<%if !@step.new_record?%> 
		.edit{
			display:none;
		}
		<%else%>
		.view, #cancel{
			display:none;
		}
		<%end%>
		</style>


